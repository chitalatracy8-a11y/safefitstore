<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Users – Admin</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f4f4; }
    header { background-color: #222; color: white; padding: 1rem; text-align: center; }
    nav { display: flex; justify-content: center; background-color: #333; }
    nav a { color: white; padding: 1rem 2rem; text-decoration: none; }
    nav a:hover { background-color: #555; }
    main { padding: 2rem; }
    table { width: 80%; margin: 0 auto; border-collapse: collapse; background-color: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    th, td { padding: 12px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #3498db; color: white; }
    button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin: 0 2px; font-weight: bold; }
    button.edit { background-color: #28a745; color: white; }
    button.delete { background-color: #dc3545; color: white; }
    button:hover { opacity: 0.9; }
    .back-button { display: inline-block; margin-bottom: 20px; padding: 10px 20px;
        background-color: #2ecc71; color: white; text-decoration: none; border-radius: 5px; }
</style>
</head>
<body>

<header>
    <h1>Manage Users</h1>
</header>

<nav>
    <a href="manage_users.html">Users</a>
    <a href="manage_orders.html">Orders</a>
    <a href="messages.html">Messages</a>
    <a href="logout.php">Logout</a>
</nav>

<main>
    <a href="admin_dashboard.html" class="back-button">← Back to Dashboard</a>
    <h2>Users List</h2>
    <table id="usersTable">
        <thead>
            <tr>
                <th>ID</th><th>Username</th><th>Email</th><th>Role</th><th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Dynamic user rows will be inserted here -->
        </tbody>
    </table>
</main>

<script>
// API endpoint (replace if different)
const API_URL = "http://localhost:5000/api";

// Load users
async function loadUsers() {
    const token = localStorage.getItem("token");
    if (!token) {
        alert("You are not logged in");
        window.location.href = "login.html";
        return;
    }

    try {
        const res = await fetch(`${API_URL}/users`, {
            headers: { "Authorization": `Bearer ${token}` }
        });
        const users = await res.json();
        const tbody = document.querySelector("#usersTable tbody");
        tbody.innerHTML = "";

        users.forEach(user => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td>${user.email || ""}</td>
                <td>${user.role || "Customer"}</td>
                <td>
                    <button class="edit" onclick="editUser(${user.id}, '${user.username}', '${user.email}', '${user.role || "Customer"}')">Edit</button>
                    <button class="delete" onclick="deleteUser(${user.id})">Delete</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    } catch(err) {
        console.error(err);
        alert("Failed to load users");
    }
}

// Delete user
async function deleteUser(id) {
    if (!confirm("Are you sure you want to delete this user?")) return;
    const token = localStorage.getItem("token");
    try {
        const res = await fetch(`${API_URL}/users/${id}`, {
            method: "DELETE",
            headers: { "Authorization": `Bearer ${token}` }
        });
        const result = await res.json();
        if (result.success) {
            alert("User deleted successfully");
            loadUsers();
        } else {
            alert("Error deleting user");
        }
    } catch(err) {
        console.error(err);
        alert("Error deleting user");
    }
}

// Edit user
function editUser(id, username, email, role) {
    const newUsername = prompt("Edit username:", username);
    const newEmail = prompt("Edit email:", email);
    const newRole = prompt("Edit role:", role);

    if (newUsername && newEmail && newRole) {
        const token = localStorage.getItem("token");
        fetch(`${API_URL}/users/${id}`, {
            method: "PUT",
            headers: { 
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify({ username: newUsername, email: newEmail, role: newRole })
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                alert("User updated successfully");
                loadUsers();
            } else {
                alert("Error updating user");
            }
        })
        .catch(err => {
            console.error(err);
            alert("Error updating user");
        });
    }
}

// Initial load
loadUsers();
</script>

</body>
</html>

